<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TaxiApp –∑ Google Maps</title>
  <style>
    html, body {
      height: 100%;
      margin: 0; padding: 0;
      font-family: Arial, sans-serif;
      display: flex; flex-direction: column;
    }
    #map {
      flex-grow: 1;
    }
    header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px 15px;
      background: #222;
      color: white;
    }
    .address-bar {
      position: absolute;
      top: 60px; left: 15px; right: 15px;
      background: rgba(255,255,255,0.9);
      border-radius: 8px;
      padding: 10px 15px;
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      font-weight: bold;
      z-index: 10;
    }
    .car-type {
      display: flex; justify-content: center; margin: 10px 0;
    }
    .car-type button {
      background: #eee; border: none; margin: 0 10px;
      padding: 10px 20px; border-radius: 30px;
      font-weight: bold; cursor: pointer;
      transition: background 0.3s ease;
    }
    .car-type button.active {
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: white;
    }
    .order-btn {
      margin: 15px auto 15px auto;
      padding: 15px 60px;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      border: none; border-radius: 35px;
      color: white; font-size: 1.2em;
      cursor: pointer;
      box-shadow: 0 6px 10px rgba(0,0,0,0.8);
      transition: box-shadow 0.3s ease;
      display: block;
      z-index: 10;
      position: relative;

    }
    .order-btn:hover {
      box-shadow: 0px 8px 15px rgba(0,0,0,1);
    }
    .order-btn:active {
      filter: brightness(0.85); /* –∑–∞—Ç–µ–º–Ω–µ–Ω–Ω—è –ø—Ä–∏ –∫–ª—ñ–∫—É */
      transform: scale(0.97);   /* –ª–µ–≥–∫–µ –≤—Ç–∏—Å–Ω–µ–Ω–Ω—è */
    }
    footer {
      display: flex; justify-content: space-around;
      background: #222; padding: 10px 0;
    }
    footer button {
      background: none; border: none; color: white;
      font-weight: bold; font-size: 1em;
      cursor: pointer;
    }
    .address-bar input {
      flex: 1;
      margin: 0 5px;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .address-bar button {
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      background: #203a43;
      color: white;
      font-weight: bold;
    }

    @media (max-width: 600px) {
      .address-bar {
        flex-direction: column;
        gap: 10px;
      }
      .address-bar input, .address-bar button {
        width: 100%;
      }
    }

    .car-selector {
      margin: 10px auto;
      max-width: 400px;
      text-align: center;
    }

    .toggle-car-list {
      padding: 10px 20px;
      background: #203a43;
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
    }
    .toggle-car-list {

    }

    #car-list {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 10px;
    }

    .car-card {
      background: #f2f2f2;
      margin: 10px;
      padding: 15px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .car-card img {
      width: 80px;
      border-radius: 10px;
    }

    .car-details {
      flex-grow: 1;
      text-align: left;
    }

    .car-details h4 {
      margin: 0;
      color: #203a43;
    }

    .car-details p {
      margin: 5px 0;
    }

    .car-details b {
      color: #007bff;
    }

    .car-details .features {
      color: #00bcd4;
      font-size: 0.95em;
    }


    #car-list:not(.hidden) {
      max-height: 1000px; /* –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≤–µ–ª–∏–∫–µ –∑–Ω–∞—á–µ–Ω–Ω—è */
    }


    #address-bar-id {
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    #address-bar-id.hidden {
      opacity: 0;
      transform: translateY(-10px);
      pointer-events: none;
    }



    .car-list-wrapper {
      overflow: hidden;
      transition: max-height 0.4s ease;
      max-height: 60px; /* –≤–∏—Å–æ—Ç–∞ –∫–Ω–æ–ø–∫–∏ */
    }

    .car-list-wrapper.open {
      max-height: 1000px; /* –∞–±–æ —Å–∫—ñ–ª—å–∫–∏ —Ç—Ä–µ–±–∞ –¥–ª—è –∞–≤—Ç—ñ–≤–æ–∫ */
    }

    #car-list {
      transition: opacity 0.4s ease;
      opacity: 0;
    }

    .car-list-wrapper.open #car-list {
      opacity: 1;
    }

  </style>
</head>
<body>
<header>
  <div>‚ò∞</div>
  <div>TaxiApp</div>
  <div></div>
</header>

<button id="focus-btn" onclick="centerOnUser()">üìç</button>
<div id="map"></div>
<div id="route-info"></div>


<div id="address-bar-id" class="address-bar">
  <input id="from-input" placeholder="–ó–≤—ñ–¥–∫–∏" />
  <input id="to-input" placeholder="–ö—É–¥–∏" />
  <button onclick="buildRoute()">–ü–æ–±—É–¥—É–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç</button>
</div>

<div class="car-selector">
  <div class="car-list-wrapper">
    <button class="toggle-car-list" onclick="toggleCarList()">
      üöó –í–∏–±—Ä–∞—Ç–∏ –∞–≤—Ç–æ <span id="arrow">‚ñº</span>
    </button>
    <div id="car-list">
      <!-- –î–∏–Ω–∞–º—ñ—á–Ω—ñ –∫–∞—Ä—Ç–∏ -->
    </div>
  </div>
</div>
<button class="order-btn" onclick="orderTaxi()">–ó–∞–º–æ–≤–∏—Ç–∏ —Ç–∞–∫—Å—ñ</button>

<footer>
  <button>–Ü—Å—Ç–æ—Ä—ñ—è</button>
  <button>–ü—Ä–æ—Ñ—ñ–ª—å</button>
  <button>–ü—ñ–¥—Ç—Ä–∏–º–∫–∞</button>
</footer>

<script>
  let selectedDistance = null;
  let autocompleteFrom, autocompleteTo;
  let fromCoords = null;
  let toCoords = null;
  let map, userMarker, destinationMarker, directionsService, directionsRenderer, geocoder;
  let currentPosition = null;

  function onGoogleMapsLoaded() {
    initMap();
    initAutocomplete();
  }

  // Google Autocomplete
  function initAutocomplete() {
    autocompleteFrom = new google.maps.places.Autocomplete(document.getElementById("from-input"));
    autocompleteTo = new google.maps.places.Autocomplete(document.getElementById("to-input"));

    autocompleteFrom.addListener("place_changed", () => {
      const place = autocompleteFrom.getPlace();
      fromCoords = {
        lat: place.geometry.location.lat(),
        lng: place.geometry.location.lng()
      };
    });

    autocompleteTo.addListener("place_changed", () => {
      const place = autocompleteTo.getPlace();
      toCoords = {
        lat: place.geometry.location.lat(),
        lng: place.geometry.location.lng()
      };
    });
  }

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–∞–ø–∏
  function initMap() {
    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer();
    geocoder = new google.maps.Geocoder();

    map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 50.4501, lng: 30.5234 },
      zoom: 15,
      disableDefaultUI: false
    });

    directionsRenderer.setMap(map);

    let hasCenteredMap = false;

    navigator.geolocation.watchPosition(
      (pos) => {
        currentPosition = {
          lat: pos.coords.latitude,
          lng: pos.coords.longitude
        };

        updateUserMarker(currentPosition);

        if (!hasCenteredMap) {
          map.setCenter(currentPosition);
          hasCenteredMap = true;

          reverseGeocode(currentPosition, (address) => {
            document.getElementById("from-input").value = address;
            fromCoords = currentPosition;
          });
        }
      },
      (err) => alert("–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è –Ω–µ –ø—Ä–∞—Ü—é—î: " + err.message),
      { enableHighAccuracy: true, maximumAge: 0 }
    );

    map.addListener("click", (e) => {
      const destination = {
        lat: e.latLng.lat(),
        lng: e.latLng.lng()
      };
      setDestination(destination);
    });
  }

  // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
  function updateUserMarker(pos) {
    if (!userMarker) {
      userMarker = new google.maps.Marker({
        position: pos,
        map: map,
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 8,
          fillColor: "#3f5efb",
          fillOpacity: 0.9,
          strokeColor: "white",
          strokeWeight: 2
        },
        title: "–í–∏ —Ç—É—Ç"
      });
    } else {
      userMarker.setPosition(pos);
    }

    reverseGeocode(pos, (address) => {
      document.getElementById("from-input").value = address;
      fromCoords = pos;
    });
  }

  // –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∏
  function centerOnUser() {
    if (currentPosition) {
      map.setCenter(currentPosition);
    }
  }

  // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—É–Ω–∫—Ç—É –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
  function setDestination(dest) {
    if (!currentPosition) {
      alert("–ì–µ–æ–ø–æ–∑–∏—Ü—ñ—è —â–µ –Ω–µ –æ—Ç—Ä–∏–º–∞–Ω–∞.");
      return;
    }

    if (!destinationMarker) {
      destinationMarker = new google.maps.Marker({
        position: dest,
        map: map,
        icon: "https://maps.google.com/mapfiles/ms/icons/green-dot.png",
        title: "–ü—É–Ω–∫—Ç –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è"
      });
    } else {
      destinationMarker.setPosition(dest);
    }

    reverseGeocode(dest, (address) => {
      document.getElementById("to-input").value = address;
      toCoords = dest;
      buildRoute(); // –ø–æ–±—É–¥–æ–≤–∞ –º–∞—Ä—à—Ä—É—Ç—É –æ–¥—Ä–∞–∑—É
    });
  }

  // –ü–æ–±—É–¥–æ–≤–∞ –º–∞—Ä—à—Ä—É—Ç—É
  function buildRoute() {
    if (!fromCoords || !toCoords) {
      alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å –æ–±–∏–¥–≤—ñ –∞–¥—Ä–µ—Å–∏.");
      return;
    }

    directionsService.route(
      {
        origin: fromCoords,
        destination: toCoords,
        travelMode: google.maps.TravelMode.DRIVING
      },
      (result, status) => {
        if (status === "OK") {
          directionsRenderer.setDirections(result);
          const distanceKm = result.routes[0].legs[0].distance.value / 1000;
          selectedDistance = distanceKm;
          const price = calculatePrice(distanceKm);
          showRouteInfo(result.routes[0].legs[0].distance.text, price);
          updateCarList(); // –æ–Ω–æ–≤–∏—Ç–∏ —Ü—ñ–Ω–∏ –≤ –∞–≤—Ç—ñ–≤–∫–∞—Ö
        } else {
          alert("–ù–µ –≤–¥–∞–ª–æ—Å—å –ø–æ–±—É–¥—É–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç: " + status);
        }
      }
    );
  }

  // –ó–≤–æ—Ä–æ—Ç–Ω–µ –≥–µ–æ–∫–æ–¥—É–≤–∞–Ω–Ω—è
  function reverseGeocode(coords, callback) {
    geocoder.geocode({ location: coords }, (results, status) => {
      if (status === "OK" && results[0]) {
        callback(results[0].formatted_address);
      } else {
        callback("–ê–¥—Ä–µ—Å—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ");
      }
    });
  }

  // –ü–æ–∫–∞–∑–∞—Ç–∏ —Ü—ñ–Ω—É —ñ –≤—ñ–¥—Å—Ç–∞–Ω—å
  function calculatePrice(km) {
    const base = 30;
    const perKm = 10;
    return Math.round(base + km * perKm);
  }

  function showRouteInfo(distance, price) {
    const info = document.getElementById("route-info");
    info.innerHTML = `üìç –í—ñ–¥—Å—Ç–∞–Ω—å: <b>${distance}</b><br>üí∞ –û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∞ —Ü—ñ–Ω–∞: <b>${price} –≥—Ä–Ω</b>`;
    info.style.display = "block";
  }

  // –ú–µ–Ω—é –∞–≤—Ç—ñ–≤–æ–∫
  const cars = [
    {
      type: "–ï–∫–æ–Ω–æ–º",
      pricePerKm: 10,
      image: "https://img.icons8.com/color/96/sedan.png",
      features: ["üîπ –í–æ–¥–∏—á–∫–∞", "üì∂ Wi-Fi"],
    },
    {
      type: "–ë—ñ–∑–Ω–µ—Å",
      pricePerKm: 18,
      image: "https://img.icons8.com/color/96/limousine.png",
      features: ["üîπ –í–æ–¥–∏—á–∫–∞", "üì∂ Wi-Fi", "üòå –¢–∏—Ö–∏–π —Ä–µ–∂–∏–º"],
    },
    {
      type: "–ö–æ–º—Ñ–æ—Ä—Ç",
      pricePerKm: 14,
      image: "https://img.icons8.com/color/96/car.png",
      features: ["üîπ –í–æ–¥–∏—á–∫–∞"],
    }
  ];

  function toggleCarList() {
    const wrapper = document.querySelector(".car-list-wrapper");
    const arrow = document.getElementById("arrow");
    const addressBar = document.getElementById("address-bar-id");

    const isOpen = wrapper.classList.toggle("open");
    arrow.textContent = isOpen ? "‚ñ≤" : "‚ñº";
    addressBar.classList.toggle("hidden", isOpen);

    const list = document.getElementById("car-list");
    if (!list.classList.contains("loaded")) {
      renderCarList();
      list.classList.add("loaded");
    } else {
      updateCarList();
    }
  }

  function renderCarList() {
    const container = document.getElementById("car-list");
    container.innerHTML = "";

    cars.forEach(car => {
      const card = document.createElement("div");
      card.className = "car-card";

      const price = selectedDistance
        ? Math.round(30 + car.pricePerKm * selectedDistance)
        : "–ù–µ–≤—ñ–¥–æ–º–æ";

      card.innerHTML = `
      <img src="${car.image}" alt="${car.type}" />
      <div class="car-details">
        <h4>${car.type}</h4>
        <p>–¶—ñ–Ω–∞ –∑–∞ –∫–º: <b>${car.pricePerKm} –≥—Ä–Ω</b></p>
        <p>–û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å: <b>${price} –≥—Ä–Ω</b></p>
        <p class="features">–ü–æ—Å–ª—É–≥–∏: ${car.features.join(", ")}</p>
      </div>
    `;

      container.appendChild(card);
    });
  }

  function updateCarList() {
    if (!selectedDistance) return;
    const prices = document.querySelectorAll(".car-card");

    prices.forEach((card, index) => {
      const priceElement = card.querySelectorAll("p")[1];
      const car = cars[index];
      const total = Math.round(30 + car.pricePerKm * selectedDistance);
      priceElement.innerHTML = `–û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å: <b>${total} –≥—Ä–Ω</b>`;
    });
  }
</script>


<script>
  function onGoogleMapsLoaded() {
    initMap();
    initAutocomplete(); // <- –î–æ–¥–∞—î–º–æ —Ü–µ
  }
</script>
<script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDH0JFSFD5fpH1dK5d9p-fU1IxvWOw9loQ&libraries=places&callback=onGoogleMapsLoaded">
</script>

</body>
</html>

