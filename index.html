<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TaxiApp –∑ Google Maps</title>
  <style>
    html, body {
      height: 100%;
      margin: 0; padding: 0;
      font-family: Arial, sans-serif;
      display: flex; flex-direction: column;
    }
    #map {
      flex-grow: 1;
    }
    header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px 15px;
      background: #222;
      color: white;
    }
    .address-bar {
      position: absolute;
      top: 60px; left: 15px; right: 15px;
      background: rgba(255,255,255,0.9);
      border-radius: 8px;
      padding: 10px 15px;
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      font-weight: bold;
      z-index: 10;
    }
    .car-type {
      display: flex; justify-content: center; margin: 10px 0;
    }
    .car-type button {
      background: #eee; border: none; margin: 0 10px;
      padding: 10px 20px; border-radius: 30px;
      font-weight: bold; cursor: pointer;
      transition: background 0.3s ease;
    }
    .car-type button.active {
      background: linear-gradient(135deg, #fc466b, #3f5efb);
      color: white;
    }
    .order-btn {
      margin: 15px auto 15px auto;
      padding: 15px 60px;
      background: linear-gradient(135deg, #fc466b, #3f5efb);
      border: none; border-radius: 35px;
      color: white; font-size: 1.2em;
      cursor: pointer;
      box-shadow: 0 6px 10px rgba(252,70,107,0.7);
      transition: box-shadow 0.3s ease;
      display: block;
      z-index: 10;
      position: relative;
    }
    .order-btn:hover {
      box-shadow: 0 8px 15px rgba(252,70,107,1);
    }
    footer {
      display: flex; justify-content: space-around;
      background: #222; padding: 10px 0;
    }
    footer button {
      background: none; border: none; color: white;
      font-weight: bold; font-size: 1em;
      cursor: pointer;
    }
  </style>
</head>
<body>
<header>
  <div>‚ò∞</div>
  <div>TaxiApp</div>
  <div></div>
</header>

<button id="focus-btn" onclick="centerOnUser()">üìç</button>
<div id="map"></div>
<div id="route-info"></div>


<div class="address-bar">
  <div id="address">–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∞–¥—Ä–µ—Å–∏...</div>
  <button onclick="editAddress()">‚úé –ó–º—ñ–Ω–∏—Ç–∏</button>
</div>

<div class="car-type">
  <button class="active" onclick="selectCarType(this)">–ï–∫–æ–Ω–æ–º</button>
  <button onclick="selectCarType(this)">–ë—ñ–∑–Ω–µ—Å</button>
</div>

<button class="order-btn" onclick="orderTaxi()">–ó–∞–º–æ–≤–∏—Ç–∏ —Ç–∞–∫—Å—ñ</button>

<footer>
  <button>–Ü—Å—Ç–æ—Ä—ñ—è</button>
  <button>–ü—Ä–æ—Ñ—ñ–ª—å</button>
  <button>–ü—ñ–¥—Ç—Ä–∏–º–∫–∞</button>
</footer>

<script>
  let map, userMarker, destinationMarker, directionsService, directionsRenderer, geocoder;
  let currentPosition = null;

  function initMap() {
    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer();
    geocoder = new google.maps.Geocoder();

    map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 50.4501, lng: 30.5234 },
      zoom: 15,
      disableDefaultUI: false
    });

    directionsRenderer.setMap(map);

    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(
        (pos) => {
          currentPosition = {
            lat: pos.coords.latitude,
            lng: pos.coords.longitude
          };
          updateUserMarker(currentPosition);
        },
        (err) => alert("–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è –Ω–µ –ø—Ä–∞—Ü—é—î: " + err.message),
        { enableHighAccuracy: true, maximumAge: 0 }
      );
    } else {
      alert("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—é.");
    }

    map.addListener("click", (e) => {
      const destination = {
        lat: e.latLng.lat(),
        lng: e.latLng.lng()
      };
      setDestination(destination);
    });
  }

  function updateUserMarker(pos) {
    if (!userMarker) {
      userMarker = new google.maps.Marker({
        position: pos,
        map: map,
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 8,
          fillColor: "#3f5efb",
          fillOpacity: 0.9,
          strokeColor: "white",
          strokeWeight: 2
        },
        title: "–í–∏ —Ç—É—Ç"
      });
    } else {
      userMarker.setPosition(pos);
    }
  }

  function centerOnUser() {
    if (currentPosition) {
      map.setCenter(currentPosition);
    }
  }

  function setDestination(dest) {
    if (!currentPosition) {
      alert("–ì–µ–æ–ø–æ–∑–∏—Ü—ñ—è —â–µ –Ω–µ –æ—Ç—Ä–∏–º–∞–Ω–∞.");
      return;
    }

    if (!destinationMarker) {
      destinationMarker = new google.maps.Marker({
        position: dest,
        map: map,
        icon: "https://maps.google.com/mapfiles/ms/icons/green-dot.png",
        title: "–ü—É–Ω–∫—Ç –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è"
      });
    } else {
      destinationMarker.setPosition(dest);
    }

    drawRoute(currentPosition, dest);
  }

  function drawRoute(origin, destination) {
    directionsService.route(
      {
        origin,
        destination,
        travelMode: google.maps.TravelMode.DRIVING
      },
      (result, status) => {
        if (status === "OK") {
          directionsRenderer.setDirections(result);
          const distanceText = result.routes[0].legs[0].distance.text;
          const distanceKm = result.routes[0].legs[0].distance.value / 1000;
          const price = calculatePrice(distanceKm);
          showRouteInfo(distanceText, price);
        } else {
          alert("–ú–∞—Ä—à—Ä—É—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ: " + status);
        }
      }
    );
  }

  function calculatePrice(km) {
    const base = 30;
    const perKm = 10;
    return Math.round(base + km * perKm);
  }

  function showRouteInfo(distance, price) {
    const info = document.getElementById("route-info");
    info.innerHTML = `üìç –í—ñ–¥—Å—Ç–∞–Ω—å: <b>${distance}</b><br>üí∞ –û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∞ —Ü—ñ–Ω–∞: <b>${price} –≥—Ä–Ω</b>`;
    info.style.display = "block";
  }
</script>

<script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDH0JFSFD5fpH1dK5d9p-fU1IxvWOw9loQ&callback=initMap">
</script>
</body>
</html>
